import numpy as np
import pandas as pd
Initial concentration at x=0 for delta case (ug/m^3)
csv_file : str
Path to CSV file containing columns: x, concentration

Returns
-------
theta0 : ndarray
Initial concentration profile
"""
theta0 = np.zeros_like(x)

if mode == "delta":
theta0[0] = value

elif mode == "csv":
if csv_file is None:
raise ValueError("csv_file must be provided when mode='csv'")
data = pd.read_csv(csv_file)
theta0 = np.interp(x, data["x"], data["concentration"])

else:
raise ValueError("Unknown initialisation mode")

return theta0


def solve_advection(x, t, theta0, U):
"""
Solve 1D advection equation using upwind finite differences.

Parameters
----------
x : ndarray
Spatial grid
t : ndarray
Time grid
theta0 : ndarray
Initial concentration
U : float or ndarray
Velocity (m/s), constant or spatially varying

Returns
-------
theta : ndarray
Concentration field (time, space)
"""
dx = x[1] - x[0]
dt = t[1] - t[0]

nx = len(x)
nt = len(t)

theta = np.zeros((nt, nx))
theta[0, :] = theta0

# Courant number check (basic stability guidance)
if np.isscalar(U):
if U * dt / dx > 1:
raise ValueError("Unstable configuration: Courant number > 1")

for n in range(0, nt - 1):
for i in range(1, nx):
u_local = U if np.isscalar(U) else U[i]
theta[n + 1, i] = (
theta[n, i]
- u_local * dt / dx * (theta[n, i] - theta[n, i - 1])
)
# Boundary condition at x=0 (no inflow after initial release)
theta[n + 1, 0] = 0.0

return theta


if __name__ == "__main__":
# Example user-defined configuration
x, t = create_domain(x_max=20.0, dx=0.2, t_max=300.0, dt=10.0)
theta0 = initialise_concentration(x, mode="delta", value=250.0)
theta = solve_advection(x, t, theta0, U=0.1)

print("Simulation complete")
print(f"Domain size: {len(x)} points, Time steps: {len(t)}")


#######################################################
test case 2
#######################################################

import pandas as pd
import numpy as np

def read_and_interpolate_initial_conditions(csv_path, x_grid, x_col='x', theta_col='theta'):
   
    "Read initial_conditions.csv and interpolate the measurements onto the model grid."

  """
    Parameters:
    csv_path : str
        #Path to the CSV file.
    x_grid : array-like
        #The model's spatial grid (e.g., produced using np.linspace).
    x_col : str
        #Name of the column in the CSV that holds x-coordinates.
    theta_col : str
        #Name of the column in the CSV that holds concentration values.

    Gives:
    theta_interp : np.ndarray
    # Interpolated concentration values matching the model grid."
    # Read CSV using pandas
    df = pd.read_csv(csv_path)
    """
    # Extract measurements
    x_measured = df[x_col].values
    theta_measured = df[theta_col].values

    # Sort by x so interpolation works correctly
    sort_idx = np.argsort(x_measured)
    x_measured = x_measured[sort_idx]
    theta_measured = theta_measured[sort_idx]

    # Interpolate onto model grid
    theta_interp = np.interp(
        x_grid,               # target grid for the model
        x_measured,           # measurement positions
        theta_measured,       # measured concentrations
        left=theta_measured[0],   # extrapolate left using nearest value
        right=theta_measured[-1]  # extrapolate right using nearest value
    )

    return theta_interp

#Making the grid
x = np.linspace(0, 20, 101)   # example grid: 0â€“20 m, dx=0.2 m

#Reads & interpolates CSV initial conditions
theta0 = read_and_interpolate_initial_conditions(
    'data/initial_conditions.csv',
    x
)
